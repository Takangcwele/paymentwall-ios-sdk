INTRODUCTION
------------
Do you want to accept payments from mobile users in different countries, different payment system by writing just few of code lines? 
Panda ++ is a global mobile payment gateway that accepts payments from more than 200 countries with 100+ alternative payment options. We now provide SDK for iOS which will become a native part of your application, it eliminates the necessity to open a web browser for payments. Less steps, faster process, there’s no doubt your conversion rate will get boost! All you have to do is import the library into your project and config it to start accepting in-app payment. It is quick and easy! We'll guide you through the process here.

HOW DOES IT WORK?
-----------------
1. Add the framework to your project. 
With different areas, we provide corresponding external payment system framework files. You can add as many as you want. You can also enable/disable default payment options too. You can add any payment option as they want by importing the payment system framework and framework plugin provided by Paymentwall to your project
2. User requests a purchase inside your application.
3. Panda++ initializes payment screen with 3 core payment options (Brick, MINT, Mobiamo) and the other is “Local Payments” option.
4. User initiates payment in-app 
With Brick, Mint, Mobiamo the payment process will totally be native.
With local payments, local payment screen will be shown with payment methods corresponding to user’s current location. Here users can then select a payment option they prefer.

REQUIREMENTS
------------
XCode 8.0+, iOS 8.0+

CREDENTIALS
-----------
SDK integration requires a project key. Obtain these Paymentwall API credentials in the application settings of your Merchant Account at [Paymentwall.com](http://paymentwall.com/)

ADDING SDK (Paymentwall Core SDK)
---------------------
Our SDK is delivered as a dynamic framework or public repository.

Install with Cocoapods:

1. Install CocoaPods 0.39.0 or later
2. In your Podfile, add `pod 'PWCoreSDK'` and `pod 'PW[Local payment method]Plugin'`(optional) to your main and test targets
3. From the command line, run `pod install`
4. Use the .xcworkspace file generated by CocoaPods
5. Add `-ObjC` to Other Linker Flags 
6. If you are using Swift you have to import the module as:

```swift
import PWCoreSDK
```

Install as Dynamic frameworks:

1. Download the latest release of the SDK and extract the zip.
2. Go to your Xcode project’s “General” settings. Drag PWCoreSDK.framework and other plugin frameworks to your project directory to the “Embedded Binaries” section. Make sure Copy items if needed is selected and click Finish.
3. In your unit test target’s “Build Settings”, add the parent path to PWCoreSDK.framework in the “Framework Search Paths” section.
4. Create a new “Run Script Phase” in your app’s target’s “Build Phases” and paste the following snippet in the script text field, this is required to get rid of the simulator binaries inside the framework to submit to App Store:
```shell
bash "${BUILT_PRODUCTS_DIR}/${FRAMEWORKS_FOLDER_PATH}/PWCoreSDK.framework/ios-strip-frameworks.sh"
```

5. If you are using Swift, create a new Objective-C file in order to create new bridging-header.h files, then import the following files into the header file like:

```objective-c
#import <PWCoreSDK/PWCoreSDK.h> 
```

Create your first payment
-------------------------
1. Create new payment with name, price, currency, image, request time out (in second) and see if you want to use your own success dialog for Brick payment flow:
```swift
PWCoreSDK.setPaymentName("Item", paymentAmount: "9.99", paymentCurrency: "USD", paymentImage: choosenItem.image, useNativeFinishDialog: true, requestTimeout: 30)
```

2. Implement `PWCoreSDKDelegate` protocol to handle payment response:

   ```swift
	func paymentResponse(_ response: PWCoreSDKResponse?) {
		guard let response = response else { return }
		switch response.responseCode {
			case .SUCCESSFUL:
			case .FAILED:
			case .CANCEL:
		}

   		switch response.paymentType {
   			case .NONE:
   			case .MINT:
   			case .PWLOCAL:
			case .BRICK:
			case .MOBIAMO:
		}
	}
```

3. Add Brick payment type, please refer below on how to handle Brick payment flow:

	```swift
PWCoreSDK.createNewBrickPayment(withPublicKey: "YOUR PUBLIC KEY")
```

4. Add Mobiamo payment type:

	```swift
PWCoreSDK.createNewMobiamoPayment(withAppID: "YOUR APP ID", userID: "10101", paymentID: "1001", noPrice: true)
```

5. Add Mint payment type:
	```swift
PWCoreSDK.createNewMintPayment(withAppID: "YOUR APP ID", userID: "10101")
```
6. Add PWLocal payment type, please refer [PWLocal docs](https://www.paymentwall.com/en/documentation/PWLocal-iOS-SDK/3358) or the demo for more ways to create PWlocal request:

	```swift
PWCoreSDK.createNewPWLocalCustomPayment(withSecretKey: "YOUR SECRET KEY", apiType: DIGITAL_GOODS, customRequestDic: customSetting)
```

7. Add any other local payment option plugin if you want, please refer Implement local payment options section below on how to create them:
	
	```swift
PWCoreSDK.addCustomPaymentOptions([alipay, unionpay, ...])
```

8. Present Payment options view controller:
	
	```swift
PWCoreSDK.showPaymentOptionsViewController(withParentViewcontroller: self, delegate: self, showCompletion: nil)
```

Brick payment flow
-------------------
1. After the token is successfully fetched, the `response: PWCoreSDKResponse` will contain the `token: BrickToken` along with it
2. Send request to your server to handle the token, if `useNativeFinishDialog` is set to `false`, you can show your own success or failed dialog after it finish, otherwise post a `Notification` to use the SDK success or failed dialog and close itself, THIS IS ONLY FOR HANDLE AFTER YOU PROCESS THE TOKEN, other error will be handle automatically without posting notification:

```swift
NotificationCenter.default.post(name: Notification.Name(BRICK_TOKEN_PROCESSED_FINISH), object: nil, userInfo: nil)
```
> Note: Pass the error as Dictionary with key = "error" and value is the error message, the SDK will automatically show failed dialog instead of successful dialog

Implement local payment option
------------------------------
Panda++ supports external payment system injection (which are in our defined payment system (PS) list). Each time you want to add a new payment system, you have to include it's native SDK into your project along with our plugin framework, our framework will handle creating all the necessary parameters then you can use them to show the native local payment SDK:

1. Add the plugin with Cocoapods with `pod 'PW[Local payment method]Plugin'` or Dynamic framework
2. Import pod modules or framework header into your project
3. Setup the plugin, each plugin have different requirements so please check their header files and local payment option docs on their websites for more information:

   ```swift
let alipay = PWAlipayPlugin()
alipay.userId = "testuser"
alipay.agExternalId = "Item id"
alipay.pwProjectKey = "YOUR PROJECT KEY"
alipay.pwSecretKey = "YOUR SECRET KEY"
alipay.signVersion = 3
alipay.appId = "YOUR APP ID"

   //For international alipay payment
alipay.itbPay = "30m"
alipay.forexBiz = "FP"
alipay.appenv = "system=ios^version=\(UIDevice.current.systemVersion)"
```

4. Handling the parameters response, you can either implement the delegate protocol or use the completion handler, if the request success, you can use it's response to call it's native form payment after dismiss the core view controller:

```swift
alipay.do { [unowned self] (response) in
            if response.responseCode != 0 {
                //Signature generate error
                print("\n message \(response.message)")
            }
            
            if let orderString = response.alipayOrderString {
                print("\n alipayResponse \(orderString)")
                self.dismiss(animated: true, completion: {
                    AlipaySDK.defaultService().payOrder(orderString, fromScheme: self.appScheme, callback: { (dict) in
                        print("\n alipay callback \(dict)")
                    })
                })
            }
        }
```


